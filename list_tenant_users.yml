#all hardcoded. change this
---
- name: Get Tenant Auth Token
  hosts: localhost
  gather_facts: no
  collections:
    - netapp.storagegrid
#
#define endpoint, user, pass and tenantid
#
  vars_prompt:
    - name: tenant_id 
      prompt: "enter accountid"
      default: "default"
      private: no
    - name: tenant_username 
      prompt: "enter username"
      default: "default"
      private: no
    - name: tenant_password
      prompt: "enter password"
      default: "default"
      private: yes
  vars_files:
    - global_vars.yml
#
#connect to endpoint ans use /api/v3/authorize
#    
  tasks:
    - name: Get Tenant Authorization Token
      uri:
        url: "{{ grid_endpoint }}/api/v3/authorize"
        method: POST
        body: '{"accountId": "{{ tenant_id }}", "username": "{{ tenant_username }}", "password": "{{ tenant_password }}"}'
        body_format: json
        validate_certs: false
        status_code: [200]
      register: auth
#
#the authtoken can be processes as auth.json.data (variable)
#
    - name: List StorageGRID Users
      uri:
        url: "{{ grid_endpoint }}/api/v3/org/users"
        method: GET
        headers:
          Authorization: "Bearer {{ auth.json.data }}"
        validate_certs: false
        status_code: [200]
      register: sg_users

    - name: Print Users
      debug:
        msg: "UserName {{ item.fullName }} (ID: {{ item.id }})"
      loop: "{{ sg_users.json.data }}" 
      loop_control:
        label: "{{ item.fullName }}"
#        var: sg_users.json.data 
